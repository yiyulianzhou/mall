/* ------------------------------------------------------------------------------
 *
 * home 首页JS
 *
 * ---------------------------------------------------------------------------- */
app.controller('appCtrl', ['$scope', '$http', 'common', function($scope, $http, common) {
    //用户反馈
    var feedback = function ()
    {
        var url = common.show_tips;
        $http({
            url: url,
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
        }).success(function(response) {
            // 列表数据
            $scope.list = response.list;

        });
    }
    feedback();
    // Echat 设置，配置Echats相关文件路径
    // ------------------------------
    require.config({
        paths: {
            echarts: common.base_url + 'assets/js/plugins/visualization/echarts'
        }
    });

    var showLine = function ()
    {
        require(
            [
                'echarts',
                'echarts/theme/limitless',
                'echarts/chart/bar',
                'echarts/chart/line'
            ],function(ec, limitless) {

                var stacked_lines = ec.init(document.getElementById('stacked_lines'));

                var getDaysData = function() {
                    $http({
                        url: common.show_line,
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
                    }).success(function(response) {

                        stacked_lines_options = {
                            color: ['#3398DB'],
                            xAxis: {
                                type: 'category',
                                data: [
                                    'First', 'Second', 'Third', 'Fourth', 'Fifth'
                                ]
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                data: [
                                    angular.fromJson(response.echarts_data[0].mon),
                                    angular.fromJson(response.echarts_data[1].mon),
                                    angular.fromJson(response.echarts_data[2].mon),
                                    angular.fromJson(response.echarts_data[3].mon),
                                    angular.fromJson(response.echarts_data[4].mon)

                                ],
                                type: 'bar'
                            }]
                        };
                        stacked_lines.setOption(stacked_lines_options,true);
                    });
                };
                getDaysData();
                var stacked2_lines = ec.init(document.getElementById('stacked2_lines'));

                var getDaysData2 = function() {
                    $http({
                        url: common.show_line2,
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
                    }).success(function(response) {

                        stacked_lines_options = {
                            color: ['#3398DB'],
                            xAxis: {
                                type: 'category',
                                data: [
                                    'First', 'Second', 'Third', 'Fourth', 'Fifth'
                                ]
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                data: [
                                    angular.fromJson(response.echarts_data[0].mon),
                                    angular.fromJson(response.echarts_data[1].mon),
                                    angular.fromJson(response.echarts_data[2].mon),
                                    angular.fromJson(response.echarts_data[3].mon),
                                    angular.fromJson(response.echarts_data[4].mon)

                                ],
                                type: 'bar'
                            }]
                        };
                        stacked2_lines.setOption(stacked_lines_options,true);
                    });
                };
                getDaysData2();
                var stacked3_lines = ec.init(document.getElementById('stacked3_lines'));

                var getDaysData3 = function() {
                    $http({
                        url: common.show_line3,
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
                    }).success(function(response) {

                        stacked_lines_options = {
                            color: ['#6398DB'],
                            xAxis: {
                                type: 'category',
                                data: [
                                    'First', 'Second', 'Third', 'Fourth', 'Fifth'
                                ]
                            },
                            yAxis: {
                                type: 'value'
                            },
                            series: [{
                                data: [
                                    angular.fromJson(response.echarts_data[0].mon),
                                    angular.fromJson(response.echarts_data[1].mon),
                                    angular.fromJson(response.echarts_data[2].mon),
                                    angular.fromJson(response.echarts_data[3].mon),
                                    angular.fromJson(response.echarts_data[4].mon)

                                ],
                                type: 'bar'
                            }]
                        };
                        stacked3_lines.setOption(stacked_lines_options,true);
                    });
                };
                getDaysData3();
                var stacked4_lines = ec.init(document.getElementById('stacked4_lines'), limitless);
                var getDaysData4 = function() {
                    $http({
                        url: common.show_line4,
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
                    }).success(function(response) {

                        stacked_lines_options = {

                            // Setup grid
                            grid: {
                                x: 80,
                                x2: 30,
                                y: 30,
                                y2: 80
                            },

                            // Add tooltip
                            tooltip: {
                                trigger: 'axis'
                            },

                            // Add legend
                            legend: {
                                data: ['商铺名称','所在小区','商铺类型','销售金额']
                            },

                            // Enable drag recalculate
                            calculable: false,

                            // Hirozontal axis
                            xAxis: [{
                                type: 'category',
                                boundaryGap: false,
                                data: angular.fromJson(response.echarts_data.days)
                            }],

                            // Vertical axis
                            yAxis: [{
                                type: 'value'
                            }],

                            // Add series
                            series: [{
                                name: '商铺名称',
                                type: 'line',
                                stack: 'Total',
                                data: angular.fromJson(response.echarts_data.shop)
                            },{
                                name: '所在小区',
                                type: 'line',
                                stack: 'Total',
                                data: angular.fromJson(response.echarts_data.district)
                            },{
                                name: '商铺类型',
                                type: 'line',
                                stack: 'Total',
                                data: angular.fromJson(response.echarts_data.type)
                            },{
                                name: '销售金额',
                                type: 'line',
                                stack: 'Total',
                                data: angular.fromJson(response.echarts_data.money)
                            }
                            ]
                        };
                        stacked4_lines.setOption(stacked_lines_options,true);
                    });
                };
                getDaysData4();
                // Resize charts
                // ------------------------------
                window.onresize = function() {
                    setTimeout(function() {
                        stacked_lines.resize();
                        stacked2_lines.resize();
                        stacked3_lines.resize();
                        stacked4_lines.resize();
                    }, 200);
                }
            })
    }
    //加载图表
    showLine();
}]);
