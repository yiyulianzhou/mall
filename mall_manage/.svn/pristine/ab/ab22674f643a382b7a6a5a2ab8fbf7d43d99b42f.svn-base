
//分类条目
var Cate =  {1: "新鲜水果",2: "时令蔬菜",3: "精选肉类",4: "活鲜水产",5:"粮油副食",6:"中式点心",7:"西餐西点",8:"禽蛋乳品",9:"南北干货",10:"滋补养生",11:"坚果炒货",12:"酱料酱菜",13:"槽卤腌制",14:"日韩美食",15:"小吃零食"};

app.filter("CateDesc", function () {
    return function (e) {
        return Cate[e];
    }
});


app.controller('appCtrl', ['$scope', '$http','appService', 'appFactory','common', function($scope, $http,appService, appFactory,common) {

    //所有列表
    $scope.alllist = [];

    // 列表数据变量初始化
    $scope.list = [];


    //商品列表数据
    var getList = function (page){
        var formData = {};

        formData.state = $scope.state;

        // loading 开
        appFactory.loadingToggle(1);

        var url = page > 1 ? common.get_category + page : common.get_category;
        $http({
            url:url,
            method:'POST',
            data:$.param(formData),
            headers:{  'Content-Type': 'application/x-www-form-urlencoded' }
        }).success(function(response){

            $scope.alllist = response.list;
            // 翻页数据
            appFactory.pagerInit(response);

            // loading 关
            appFactory.loadingToggle(0);
        });

    }

    $scope.filterList = function (event) {
        if($scope.state != event)
        {
            searchDataInit();
            $scope.state = '';

            if(event == 'all')
            {
                $scope.all = true;
                $scope.open = false;
                $scope.off = false;
                $scope.state = '';
            }

            if(event == 'open')
            {
                $scope.all = false;
                $scope.open = true;
                $scope.off = false;
                $scope.state = 1;
            }

            if(event == 'off')
            {
                $scope.all = false;
                $scope.open = false;
                $scope.off = true;
                $scope.state = 0;
            }
        }
        getList(1);
    }

    //页面初始化首次获取列表
    getList(1);


    // 搜索条件初始化
    var searchDataInit = function() {
        $scope.all = true;
        $scope.open = false;
        $scope.off = false;
    }
    searchDataInit();

    // 翻页
    $scope.changePager = function(page, $event) {
        getList(page);
    }

    /*
     * 添加分类
     * item: 当前单条数据对象
     * id: ID
     */
    $scope.fullData = {};
    $scope.id = 0;
    $scope.state = 2;
    $scope.getData = function(id) {
        var formData = {};
        // 请求信息
        $http({
            url: common.cate_detail_url + id,
            method: 'GET',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
        }).success(function(response) {

            //商品名称
            $scope.fullData.name = response.item.name;

            //商品图片
            $scope.fullData.img = response.item.img;

            // 销售方式
            $scope.fullData.sales_type = response.item.sales_type;

            // 商品分类
            $scope.fullData.cate_name = response.item.cate_name;


            // 以下字段是表单提交的信息
            // ID
            $scope.id = response.item.id;

            // 分类状态
            $scope.state = response.item.state == 1 ? 2 : response.item.state;
        });
    };

    /*
     * 更新数据
     * id: ID
     */
    $scope.save = function() {
        var formData = {};
        // 更新的数据
        formData.state = $scope.state;

        // 请求更新数据开始
        appFactory.loadingToggle(1);
        $http({
            url: common.verifys_url + $scope.id,
            method: 'POST',
            data: $.param(formData),
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
        }).success(function(response) {
            // 信息弹出框
            appFactory.simpleAlert(response);

            // 更新成功需更新list中的数据
            if (response.msg_type == 'success') {
                // 隐藏模态框
                $('#verify_modal').modal('hide');
                $scope.changePager($scope.curpage, '');
            }
            appFactory.loadingToggle(0);
        });
        // 请求结束

    };

}]);




